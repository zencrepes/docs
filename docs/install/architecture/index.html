<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.63">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-1488177-27","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><title data-react-helmet="true">Architecture | ZenCrepes</title><meta data-react-helmet="true" name="docsearch:version" content="current,latest"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Architecture | ZenCrepes"><meta data-react-helmet="true" name="description" content="ZenCrepes architecture is fairly straight forward, it fetches data from remote sources, pushes it to a data store and display everything with a UI."><meta data-react-helmet="true" property="og:description" content="ZenCrepes architecture is fairly straight forward, it fetches data from remote sources, pushes it to a data store and display everything with a UI."><meta data-react-helmet="true" property="og:url" content="https://docs.zencrepes.io/docs/install/architecture"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://docs.zencrepes.io/docs/install/architecture"><link rel="stylesheet" href="/styles.4e51d241.css">
<link rel="preload" href="/styles.2584cd3b.js" as="script">
<link rel="preload" href="/runtime~main.729aeb6c.js" as="script">
<link rel="preload" href="/main.4184cea5.js" as="script">
<link rel="preload" href="/1.9a159a6a.js" as="script">
<link rel="preload" href="/2.f6f39416.js" as="script">
<link rel="preload" href="/35.70ff253e.js" as="script">
<link rel="preload" href="/36.c0e6a14f.js" as="script">
<link rel="preload" href="/935f2afb.2840cf23.js" as="script">
<link rel="preload" href="/17896441.04de4d84.js" as="script">
<link rel="preload" href="/75a2d655.1331dda1.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/zencrepes.svg" alt="ZenCrepes Logo"><strong class="navbar__title">ZenCrepes</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/zencrepes" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><a href="https://github.com/zencrepes/zencrepes/issues" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Issues</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/zencrepes.svg" alt="ZenCrepes Logo"><strong class="navbar__title">ZenCrepes</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/">Docs</a></li><li class="menu__list-item"><a href="https://github.com/zencrepes" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a href="https://github.com/zencrepes/zencrepes/issues" target="_blank" rel="noopener noreferrer" class="menu__link">Issues</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/features">Features</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/try">Try It !</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/faq">FAQ</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Serverless</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/serverless">Discover</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Install</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/install/architecture">Architecture</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/install/configuration">Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/install/authentication">Authentication</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Use</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/use/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/use/querying">Querying</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Datasets</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">GitHub</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/github/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/github/issues">Issues</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/github/repositories">Repositories</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/github/labels">Labels</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/github/milestones">Milestones</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/github/projects">Projects</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/github/prs">Pull Requests</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/github/releases">Releases</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/github/vulnerabilities">Vulnerabilities</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/github/watchers">Watchers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/github/import">Import Issues</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">CircleCI</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/circleci/envvars">Env Vars</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/circleci/pipelines">Pipelines</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/circleci/insights">Insights</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Jira</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/jira/issues">Issues</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Tests</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tests/states">States</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Develop</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/develop/getstarted">Get Started</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Architecture</h1></header><div class="markdown"><p>ZenCrepes architecture is fairly straight forward, it fetches data from remote sources, pushes it to a data store and display everything with a UI.</p><p>ZenCrepes&#x27;s stack is made of the following services:</p><ul><li><strong>zindexer</strong>: A bulk data fetcher</li><li><strong>zqueue</strong>: A event driven data fetcher (to be implemented)</li><li><strong>Elasticsearch</strong>: The datastore</li><li><strong>zapi</strong>: A GraphQL API linking the UI to the datastore</li><li><strong>zui</strong>: The user interface</li><li><strong>Keycloak</strong>: An authentication/authorization provider (optional)</li></ul><p><img src="/assets/images/zencrepes-architecture-02755c296aadd8faf95e3ff8a0bede56.png"></p><p>All services are meant to be running in Docker, corresponding containers are available on <a href="https://hub.docker.com/orgs/zencrepes/repositories" target="_blank" rel="noopener noreferrer">Docker Hub</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="zindexer"></a>Zindexer<a aria-hidden="true" tabindex="-1" class="hash-link" href="#zindexer" title="Direct link to heading">#</a></h2><p>Zindexer is a CLI tool created to fetch data, in bulk, from many sources (it plays gently with GitHub API by following rate limits). Data is then pushed to an Elasticsearch cluster.</p><p>For those using ZenCrepes primariraly with GitHub, zindexer is only really useful during initial setup, it will provision the Elasticsearch cluster with any historical data. Following the initial fetch, <code>zqueue</code> would take over and push nodes updates whenever they happen.
For the other data sources, in the absence of web-hooks, zindxer can be cron&#x27;d to fetch additional data at regular interval.</p><p>A couple of things worth noting:</p><ul><li>The node ID (an Issue, a project, a milestone) is ported over from the data source to the elasticsearch index, which prevents duplicated data. For example if <code>zqueue</code> receives an update for a node that was previously imported by <code>zindexer</code>, this node will be updated.</li><li>Whenever possible (depending of the data source API characteristics), nodes are fetched sorted by last update date (descending), when the system fetch an issue that is already present and has the same late update date, it knows it can stop fetching further nodes.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="zqueue"></a>Zqueue<a aria-hidden="true" tabindex="-1" class="hash-link" href="#zqueue" title="Direct link to heading">#</a></h2><p>Zqueue is a queue aimed at processing events received after registering a webhook with GitHub.</p><p>It contains three Redis queues:</p><ul><li><strong>github</strong>: Limited to processing one queue element at a time and per second (to play nicely with <a href="https://developer.github.com/v3/#rate-limiting" target="_blank" rel="noopener noreferrer">GitHub rate limits</a>), this queue initiates a call to GitHub to fetch additional metadata, not included in the webhook payload. The objective here is to reach content parity with nodes fetches using <a href="http://github.com/zencrepes/zindexer" target="_blank" rel="noopener noreferrer">Zindexer</a>.</li><li><strong>storepayload</strong>: Pushes the payload to an elasticsearch index (one index per payload type) while trying to keep only one document per github node (overwrite on update). It aims at providing the latest state of a node.</li><li><strong>storerawpayload</strong>: Pushes the payload to an elasticsearch index (one index per payload type) and record the date at which the event was received. It aims at providing a timeline view of nodes lifecycle.</li></ul><p><code>storepayload</code> and <code>storerawpayload</code> are mostly there for those willing to diving in their data using a tool like Kibana or to archive GitHub events on their organization. ZenCrepes doesn&#x27;t try to access datasets processed through these two queues.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="elasticsearch"></a>Elasticsearch<a aria-hidden="true" tabindex="-1" class="hash-link" href="#elasticsearch" title="Direct link to heading">#</a></h2><p>Elasticsearch is the datastore for the project, two options are available for indices:</p><ul><li>One index per data source and data type (all GitHub issues, all Jira issues, ...)</li><li>One index per data repository, data source and data type, using index aliases for querying.</li></ul><p>Cluster sizing is not going to be discussed in this documentation, there are many resources available online covering this topic.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="zapi"></a>Zapi<a aria-hidden="true" tabindex="-1" class="hash-link" href="#zapi" title="Direct link to heading">#</a></h2><p>Zapi is a GraphQL api providing an interface between the Elasticsearch datastore and our UI. It supports querying through an abstraction language called <a href="https://arranger.readthedocs.io/en/latest/src/sqon.html" target="_blank" rel="noopener noreferrer">SQON</a> and supports pagination, aggregations and various ZenCrepes-specific operations.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="zui"></a>Zui<a aria-hidden="true" tabindex="-1" class="hash-link" href="#zui" title="Direct link to heading">#</a></h2><p>Zui is ZenCrepes front-end, nothing particular to mention about it. It interacts primariraly with Zapi, and will (not implemented yet) in some occurences communicate directly with the data source (GitHub in particular) for bulk operations (if authentication/authorization is set-up properly).</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="keycloak"></a>Keycloak<a aria-hidden="true" tabindex="-1" class="hash-link" href="#keycloak" title="Direct link to heading">#</a></h2><p><a href="https://www.keycloak.org/" target="_blank" rel="noopener noreferrer">Keycloak</a> is an identify and access management solution, it is used to control access to the data. Keycloak can be disabled through environment variables, although this usecase is only recommended during development.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/zencrepes/docs/tree/master/docs/docs/install/architecture.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/serverless"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« ZenCrepes Serverless</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/install/configuration"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Configuration Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#zindexer" class="table-of-contents__link">Zindexer</a></li><li><a href="#zqueue" class="table-of-contents__link">Zqueue</a></li><li><a href="#elasticsearch" class="table-of-contents__link">Elasticsearch</a></li><li><a href="#zapi" class="table-of-contents__link">Zapi</a></li><li><a href="#zui" class="table-of-contents__link">Zui</a></li><li><a href="#keycloak" class="table-of-contents__link">Keycloak</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="http://slack.overture.bio/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack @overture.bio #app_zencrepes</a></li></ul></div></div><div class="text--center"><div>Copyright Â© 2020 ZenCrepes. Site built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.2584cd3b.js"></script>
<script src="/runtime~main.729aeb6c.js"></script>
<script src="/main.4184cea5.js"></script>
<script src="/1.9a159a6a.js"></script>
<script src="/2.f6f39416.js"></script>
<script src="/35.70ff253e.js"></script>
<script src="/36.c0e6a14f.js"></script>
<script src="/935f2afb.2840cf23.js"></script>
<script src="/17896441.04de4d84.js"></script>
<script src="/75a2d655.1331dda1.js"></script>
</body>
</html>