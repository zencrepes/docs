<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.56">
<title data-react-helmet="true">Authentication &amp; Authorization | ZenCrepes</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Authentication &amp; Authorization | ZenCrepes"><meta data-react-helmet="true" name="description" content="Authentication &amp; Authorization is handled through Keycloak, which can be enabled or disabled in ZenCrepes through environment variables. Keycloak can be used to authenticate and authorize users accessing data through the API (don&#x27;t expose your Elasticsearch instance !)."><meta data-react-helmet="true" property="og:description" content="Authentication &amp; Authorization is handled through Keycloak, which can be enabled or disabled in ZenCrepes through environment variables. Keycloak can be used to authenticate and authorize users accessing data through the API (don&#x27;t expose your Elasticsearch instance !)."><meta data-react-helmet="true" property="og:url" content="https://docs.zencrepes.io/docs/install/authentication"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://docs.zencrepes.io/docs/install/authentication"><link rel="stylesheet" href="/styles.ac071a37.css">
<link rel="preload" href="/styles.3b67f8d9.js" as="script">
<link rel="preload" href="/runtime~main.4404a578.js" as="script">
<link rel="preload" href="/main.af612167.js" as="script">
<link rel="preload" href="/1.87f1d50b.js" as="script">
<link rel="preload" href="/2.a8336ccb.js" as="script">
<link rel="preload" href="/33.c1239ad2.js" as="script">
<link rel="preload" href="/34.abb44a02.js" as="script">
<link rel="preload" href="/20ac7829.47659858.js" as="script">
<link rel="preload" href="/6d663ef3.8756fe4e.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/zencrepes.svg" alt="ZenCrepes Logo"><strong class="navbar__title">ZenCrepes</strong></a></div><div class="navbar__items navbar__items--right"><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/zencrepes.svg" alt="ZenCrepes Logo"><strong class="navbar__title">ZenCrepes</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp"><div class="sidebar_1kLs"><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/introduction">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/features">Features</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/try">Try It !</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/faq">FAQ</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Serverless</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/serverless">Discover</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Install</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/install/architecture">Architecture</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/install/configuration">Configuration</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/install/authentication">Authentication</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">GitHub</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/github/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/github/import">Import Issues</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/github/issues">Issues</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/github/labels">Labels</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/github/milestones">Milestones</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/github/projects">Projects</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/github/prs">Pull Requests</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/github/releases">Releases</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/github/vulnerabilities">Vulnerabilities</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/github/watchers">Watchers</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">CircleCI</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/circleci/envvars">Env Vars</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/circleci/pipelines">Pipelines</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/circleci/insights">Insights</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Jira</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/jira/issues">Issues</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Develop</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/develop/getstarted">Get Started</a></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="container padding-vert--lg docItemWrapper_1cc7"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">Authentication &amp; Authorization</h1></header><div class="markdown"><p>Authentication &amp; Authorization is handled through <a href="https://www.keycloak.org/" target="_blank" rel="noopener noreferrer">Keycloak</a>, which can be enabled or disabled in ZenCrepes through environment variables. Keycloak can be used to authenticate and authorize users accessing data through the API (don&#x27;t expose your Elasticsearch instance !).</p><p>Instructions on how to get started with Keycloak are available on <a href="https://www.keycloak.org/getting-started/getting-started-docker" target="_blank" rel="noopener noreferrer">their website</a>.</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>Although this section of the documentation will present instructions on how to get started quickly with Keycloak, it should NOT be considered a best practice or recommended configuration. It remains your responsibilty to understand the data your are exposing, how this data should be protected and what mechanisms are being implemented to ensure rightful access. Use the below (and ZenCrepes in general), at your own risks.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="deploy-and-configure-keycloak"></a>Deploy and Configure Keycloak<a aria-hidden="true" tabindex="-1" class="hash-link" href="#deploy-and-configure-keycloak" title="Direct link to heading">#</a></h2><p>Start by deploying Keycloak (in a Docker container for example).</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker run -p </span><span class="token number" style="color:rgb(247, 140, 108)">8080</span><span class="token plain">:8080 -e </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">KEYCLOAK_USER</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">admin -e </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">KEYCLOAK_PASSWORD</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">admin quay.io/keycloak/keycloak:latest</span></div></div></div></div></div><p>Once done, log into the administration panel: http://localhost:8080/auth/admin</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="create-a-realm"></a>Create a Realm<a aria-hidden="true" tabindex="-1" class="hash-link" href="#create-a-realm" title="Direct link to heading">#</a></h3><p>From there, mouse-over &quot;Master&quot; (the default Realm) and click on &quot;Add realm&quot; and give it the name <code>ZenCrepes</code>.</p><p><img src="/img/keycloak-create-realm-menu.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="create-a-client"></a>Create a Client<a aria-hidden="true" tabindex="-1" class="hash-link" href="#create-a-client" title="Direct link to heading">#</a></h3><p>We will then create a client by clicking (within the zencrepes realm) on <code>Clients</code> &gt; <code>Create</code>. The client will be the ZenCrepes application that will be used by users to authenticate with KeyCloak.</p><p><img src="/img/keycloak-add-client.png"></p><ul><li><strong> Client ID</strong>: Use <code>zencrepes</code>, this name has a different purpose than the realm, but it doesn&#x27;t hurt using the same value</li><li><strong> Client Protocol</strong>: Select <code>openid-connect</code></li><li><strong> Root URL</strong>: The URL you&#x27;re using to access ZenCrepes: <code>http://localhost:3000</code> (for the purpose of this guide).</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="identity-provider"></a>Identity Provider<a aria-hidden="true" tabindex="-1" class="hash-link" href="#identity-provider" title="Direct link to heading">#</a></h3><p>Although ZenCrepes would allow you to use any Identify Provider (or none if you want to rely solely on KeyCloak), using GitHub as an identity provider will allow you to enable (upcoming) features allowing bulk modifications to be performed. Such actions will be performed directly between the user&#x27;s browser and GitHub, thus requiring a user authenticated with GitHub.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="register-a-client-in-github"></a>Register a Client in GitHub<a aria-hidden="true" tabindex="-1" class="hash-link" href="#register-a-client-in-github" title="Direct link to heading">#</a></h4><p>In GitHub, create a new OAuth App (either under an Organization&#x27;s settings or under your own settings), specifying the following:</p><ul><li><strong> Application Name </strong>: The desired name of your application</li><li><strong> Hompage URL </strong>: The Keycloak URL of the realm, for dev we&#x27;re using: <code>http://localhost:8080/realms/ZenCrepes</code></li><li><strong> Application callback URL </strong>: <code>http://localhost:8080/auth/realms/ZenCrepes/broker/github/endpoint</code></li></ul><p>GitHub will automatically generate a Client ID and Client Secret, those will be necessary in the next step.</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>If you are using Keycloak and the correponsing ZenCrepes docker-compose file, and plan to play with it locally, please read the bottom of the <code>Getting Started &gt; Try It !</code> section of this documentation, regarding the use of localhost.</p></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="create-an-identify-provider"></a>Create an Identify Provider<a aria-hidden="true" tabindex="-1" class="hash-link" href="#create-an-identify-provider" title="Direct link to heading">#</a></h4><p>In Keycloak, create a GitHub identify provider by clicking on &quot;Identity Providers&quot;, &quot;Add provider ...&quot; and selecting <code>GitHub</code>. Enter the following settings:</p><ul><li><strong> Client ID</strong>: The Client ID you just got from GitHub</li><li><strong> Client Secret</strong>: The Client Secret you just got from GitHub</li><li><strong> Default Scopes</strong>: Use the following <code>user:email, read:org, repo</code>, they will be needed if we want user to start batch modifying content</li><li><strong> Store Tokens</strong>: ON</li><li><strong> Store Tokens Readable</strong>: This parameter must be turned <code>ON</code> to allow authenticated users to retrieve their token and make direct calls to GitHub. Note that is users connected before this setting was turned on, those users will need to be deleted from Keycloak.</li></ul><p>Leave the rest by default.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="enable-keycloak-on-zui"></a>Enable Keycloak on ZUI<a aria-hidden="true" tabindex="-1" class="hash-link" href="#enable-keycloak-on-zui" title="Direct link to heading">#</a></h2><p>ZenCrepes ZUI supports passing Keycloak details through environment variable, use the following:</p><ul><li><strong> KEYCLOAK_DISABLED</strong> : Whether Keycloak should be disabled or not, set this to false</li><li><strong> KEYCLOAK_AUTH_SERVER_URL </strong>: URL of the Keycloak server, for us: <code>http://localhost:8080/auth/</code></li><li><strong> KEYCLOAK_AUDIENCE </strong>: The root URL of your application, for us: <code>http://localhost:3000</code></li><li><strong> KEYCLOAK_REALM </strong>: Your Realm, for us: <code>ZenCrepes</code></li><li><strong> KEYCLOAK_CLIENT_ID </strong>: The client ID you set-up in Keycloak, for us: <code>zencrepes</code></li></ul><p>You can set these as environment variables in the docker image (at run or in <code>docker-compose.yml</code>) or, for developers, by modifying the <code>.env</code> file in ZUI&#x27;s root directory and restarting the UI.</p><p>You should then see the Authentication screen after restarting (if Keycloak is disable this screen is not visible)</p><p><img src="/img/zencrepes-zui-auth-screen.png"></p><p>Try logging-in with your credentials, if successful, you should see your GitHub Avatar displayed on the top-right corner of the screen, if this is the case this demonstrate that your browser was indeed capable of authenticating to GitHub directly after the Keycloak flow.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="enable-keycloak-on-zapi"></a>Enable Keycloak on ZAPI<a aria-hidden="true" tabindex="-1" class="hash-link" href="#enable-keycloak-on-zapi" title="Direct link to heading">#</a></h2><p>ZenCrepes ZAPI supports passing Keycloak details through environment variable, use the following:</p><ul><li><strong> KEYCLOAK_DISABLED </strong> : Whether Keycloak should be disabled or not, set this to false</li><li><strong> KEYCLOAK_AUTH_SERVER_URL </strong>: URL of the Keycloak server, for us: <code>http://localhost:8080/auth/</code></li><li><strong> KEYCLOAK_AUDIENCE </strong>: Leave empty (default) except if you specified it in Keycloak.</li><li><strong> KEYCLOAK_REALM </strong>: Your Realm, for us: <code>ZenCrepes</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="checkpoint"></a>Checkpoint<a aria-hidden="true" tabindex="-1" class="hash-link" href="#checkpoint" title="Direct link to heading">#</a></h2><p>At this point, access to ZenCrepes will be protected by requiring the user to log-in with GitHub, but that doesn&#x27;t really protect access to your application. We dealt with the Authentication portion, now the next step is configuring Authorization in Keycloak to control which GitHub user are authorized to log-in.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="configure-keycloak-for-authorization"></a>Configure Keycloak for Authorization<a aria-hidden="true" tabindex="-1" class="hash-link" href="#configure-keycloak-for-authorization" title="Direct link to heading">#</a></h2><p>From the perspective of Authorization, ZenCrepes has an all-or-nothing approach and currently don&#x27;t offer any granularity in authorizing access to its dataset (users either have access to all datasets or don&#x27;t have any accesses at all).</p><p>The Authorization layer is handled through role assignment.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="more-about-authorization"></a>More about Authorization<a aria-hidden="true" tabindex="-1" class="hash-link" href="#more-about-authorization" title="Direct link to heading">#</a></h3><p>ZenCrepes supports two modes for authorization, the first one through group membership, the second one through checking the user email.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="authorization-through-group-membership"></a>Authorization through Group membership<a aria-hidden="true" tabindex="-1" class="hash-link" href="#authorization-through-group-membership" title="Direct link to heading">#</a></h3><p>Authentication &amp; Authorization is handled at ZAPI level through decoding a JWT, during authentication, users assigned to a pre-defined role will automatically see their secured token populated with this extra role.</p><p>If the role is missing from the JWT token, access to the data will be denied.</p><p>Roles can also be mapped to user groups, which is the approach that will be documented here. A group will be created and a role will be mapped to this group. By adding users to the groups, users will inherit the role, which will then be verified by the API.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="create-a-group"></a>Create a Group<a aria-hidden="true" tabindex="-1" class="hash-link" href="#create-a-group" title="Direct link to heading">#</a></h4><p>The first step is to create a group of authorized ZenCrepes users.</p><p>Go back to Keycloak admin, select your Realm (<code>ZenCrepes</code>), click on &quot;Groups&quot; in the &quot;Manage&quot; section. Then click on &quot;New&quot; to create a new group.</p><p>For the purpose of this guide we&#x27;ll call this group <code>zencrepes-users</code>.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="create-a-role"></a>Create a Role<a aria-hidden="true" tabindex="-1" class="hash-link" href="#create-a-role" title="Direct link to heading">#</a></h4><p>Within your Realm (<code>ZenCrepes</code>), click on &quot;Roles&quot; in the &quot;Configure&quot; section. Then click on &quot;Add Role&quot;.</p><p>We&#x27;ll call this role <code>zencrepes-data</code>.</p><p><img src="/img/keycloak-create-role.png"></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="attach-the-role-to-the-group"></a>Attach the role to the group<a aria-hidden="true" tabindex="-1" class="hash-link" href="#attach-the-role-to-the-group" title="Direct link to heading">#</a></h4><p>Go back to the group you created earlier (<code>zencrepes-users</code>), click on &quot;Edit&quot;, select the &quot;Role Mappings&quot; tab and add <code>zencrepes-data</code> to the &quot;Assigned Roles.</p><p><img src="/img/keycloak-group-role-mapping.png"></p><p>From that point on, any users assigned to this group will also receive the <code>zencrepes-data</code> role, but we didn&#x27;t configure any yet (on purpose).</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="update-zapi-configuration"></a>Update ZAPI configuration<a aria-hidden="true" tabindex="-1" class="hash-link" href="#update-zapi-configuration" title="Direct link to heading">#</a></h4><p>Go back to ZAPI environment variables configuration and update environment variables.</p><ul><li><strong> KEYCLOAK_ROLE </strong> : The role to check for in the token, for us: <code>zencrepes-data</code></li></ul><p>Restart the API with this new variable.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="verify-configuration"></a>Verify configuration<a aria-hidden="true" tabindex="-1" class="hash-link" href="#verify-configuration" title="Direct link to heading">#</a></h4><p>Try logging in ZenCrepes, you&#x27;ll get a denied request and will be redirected back to the login page.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="add-user-to-group"></a>Add user to group<a aria-hidden="true" tabindex="-1" class="hash-link" href="#add-user-to-group" title="Direct link to heading">#</a></h4><p>Go back to Keycloak admin, select your Realm (<code>ZenCrepes</code>), click on &quot;Users&quot; in the &quot;Manage&quot; section and click on &quot;View all users&quot;.</p><p>Select your user, click on &quot;Edit&quot;, go the the &quot;Groups&quot; tab and add the user to group <code>zencrepes-users</code>.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="verify-configuration-1"></a>Verify configuration<a aria-hidden="true" tabindex="-1" class="hash-link" href="#verify-configuration-1" title="Direct link to heading">#</a></h4><p>Log-out and log back in.</p><p>Your user should now be authorized to access ZenCrepes data, for all subsequent logins you will simply have to add users to the <code>zencrepes-users</code> group for them to be allowed to access ZenCrepes data</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="authorization-through-email-pattern"></a>Authorization through email pattern<a aria-hidden="true" tabindex="-1" class="hash-link" href="#authorization-through-email-pattern" title="Direct link to heading">#</a></h3><p>The second mode consists in verifying the user&#x27;s email address towards a pre-configured pattern.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="disable-account-login"></a>Disable account login<a aria-hidden="true" tabindex="-1" class="hash-link" href="#disable-account-login" title="Direct link to heading">#</a></h4><p>Keycloak provides an optional UI to let users edit their profile, this includes updating their email address, which is a feature we want to make sure is disabled.</p><p>You can verify if this feature is disabled or enabled by accessing http://localhost:8080/auth/realms/ZenCrepes/account/ after a successful authentication to ZenCrepes.</p><p>You should see a <code>Page not found</code> message if the feature is disabled.</p><p>Otherwise, connect to Keycloak administration:</p><ul><li>select your Realm (ZenCrepes)</li><li>click on the <code>Clients</code> section</li><li>select the <code>account</code> Client ID</li><li>move the <code>Enabled</code> cursor to <code>OFF</code></li><li>save</li></ul><p>You can try accessing http://localhost:8080/auth/realms/ZenCrepes/account/ again.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="edit-zencrepes-configuration-file"></a>Edit Zencrepes configuration file.<a aria-hidden="true" tabindex="-1" class="hash-link" href="#edit-zencrepes-configuration-file" title="Direct link to heading">#</a></h4><p>Open up your <code>config.yml</code> file and update the following section:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-yml codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">auth</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">domainCheck</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">WARNING</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      If enabled</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> for each call received by the API</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> the user email will be</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      verified aginst that list of domains. User will be granted if the user</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      email includes the domain string. Do not forget to disable Account login </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      in your Realm configuration.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">domains</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;@mydomain.com&#x27;</span></div></div></div></div></div><p>In every call ZAPI will receive, it will check the user&#x27;s email contained in the JWT token and check if the email includes part of the domains.</p><p>For example <code>joe@mydomain.com</code> will be granted access. But if you were to just add <code>joe</code> in the domain section, it would grant access to <code>joe@test.com</code> but also <code>alex@joedomain.com</code>, so just make sure you configure those fields properly.</p><p>You can specify multiple &quot;domains&quot;, ZAPI will pass if it matches at least one.</p><p>PS: The warning message is just there for the administrator while editing the config file.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="restart-zapi"></a>Restart ZAPI<a aria-hidden="true" tabindex="-1" class="hash-link" href="#restart-zapi" title="Direct link to heading">#</a></h4><p>ZAPI&#x27;s configuration is only read at startup, so simply restart your container to read the updated configuration file.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/zencrepes/docs/tree/master/docs/docs/install/authentication.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/install/configuration"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Configuration</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/github/overview"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Overview »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#deploy-and-configure-keycloak" class="table-of-contents__link">Deploy and Configure Keycloak</a><ul><li><a href="#create-a-realm" class="table-of-contents__link">Create a Realm</a></li><li><a href="#create-a-client" class="table-of-contents__link">Create a Client</a></li><li><a href="#identity-provider" class="table-of-contents__link">Identity Provider</a></li></ul></li><li><a href="#enable-keycloak-on-zui" class="table-of-contents__link">Enable Keycloak on ZUI</a></li><li><a href="#enable-keycloak-on-zapi" class="table-of-contents__link">Enable Keycloak on ZAPI</a></li><li><a href="#checkpoint" class="table-of-contents__link">Checkpoint</a></li><li><a href="#configure-keycloak-for-authorization" class="table-of-contents__link">Configure Keycloak for Authorization</a><ul><li><a href="#more-about-authorization" class="table-of-contents__link">More about Authorization</a></li><li><a href="#authorization-through-group-membership" class="table-of-contents__link">Authorization through Group membership</a></li><li><a href="#authorization-through-email-pattern" class="table-of-contents__link">Authorization through email pattern</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="http://slack.overture.bio/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack @overture.bio #app_zencrepes</a></li></ul></div></div><div class="text--center"><div>Copyright © 2020 ZenCrepes. Site built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.3b67f8d9.js"></script>
<script src="/runtime~main.4404a578.js"></script>
<script src="/main.af612167.js"></script>
<script src="/1.87f1d50b.js"></script>
<script src="/2.a8336ccb.js"></script>
<script src="/33.c1239ad2.js"></script>
<script src="/34.abb44a02.js"></script>
<script src="/20ac7829.47659858.js"></script>
<script src="/6d663ef3.8756fe4e.js"></script>
</body>
</html>